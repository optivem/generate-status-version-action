name: Test Action

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    name: Test Generate Status Version Action
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Test action with sample inputs
        id: test-action
        uses: ./
        with:
          version: 'v1.0.0'
          environment: 'testing'
          status: 'passed'
          
      - name: Verify output
        run: |
          echo "Generated version: ${{ steps.test-action.outputs.version }}"
          if [ "${{ steps.test-action.outputs.version }}" != "v1.0.0-testing-passed" ]; then
            echo "❌ Test failed: Expected 'v1.0.0-testing-passed', got '${{ steps.test-action.outputs.version }}'"
            exit 1
          else
            echo "✅ Test passed: Output matches expected result"
          fi

  test-multiple-scenarios:
    runs-on: ubuntu-latest
    name: Test Multiple Scenarios
    
    strategy:
      matrix:
        version: ['v1.0.0', 'v2.1.3-rc', '1.5.0-beta']
        environment: ['qa', 'staging', 'production']
        status: ['deployed', 'failed', 'passed']
        
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Test action
        id: test
        uses: ./
        with:
          version: ${{ matrix.version }}
          environment: ${{ matrix.environment }}
          status: ${{ matrix.status }}
          
      - name: Verify output format
        run: |
          expected="${{ matrix.version }}-${{ matrix.environment }}-${{ matrix.status }}"
          actual="${{ steps.test.outputs.version }}"
          echo "Expected: $expected"
          echo "Actual: $actual"
          if [ "$actual" != "$expected" ]; then
            echo "❌ Test failed: Output doesn't match expected format"
            exit 1
          else
            echo "✅ Test passed for ${{ matrix.version }}-${{ matrix.environment }}-${{ matrix.status }}"
          fi

  test-windows:
    runs-on: windows-latest
    name: Test on Windows
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Test action on Windows
        id: test-windows
        uses: ./
        with:
          version: 'v1.0.0'
          environment: 'windows-test'
          status: 'passed'
          
      - name: Verify Windows output
        shell: pwsh
        run: |
          $expected = "v1.0.0-windows-test-passed"
          $actual = "${{ steps.test-windows.outputs.version }}"
          Write-Host "Expected: $expected"
          Write-Host "Actual: $actual"
          if ($actual -ne $expected) {
            Write-Host "❌ Windows test failed"
            exit 1
          } else {
            Write-Host "✅ Windows test passed"
          }